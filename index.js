!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Scrollbar=t()}(this,function(){"use strict";function c(e){return"[object Function]"===Object.prototype.toString.call(e)}var i,e=navigator.userAgent.toLowerCase(),d=0<=e.indexOf("firefox"),t=0<=e.indexOf("android"),s=/(iphone|ipad|ipod|ios)/.test(e),r=0<=e.indexOf("windows phone"),n=0<=e.indexOf("symbianos"),l=t||s||r||n,o=function(){var t=!1;try{var e={};Object.defineProperty(e,"passive",{get:function(){t=!0}}),window.addEventListener("test-passive",null,e)}catch(e){t=!1}return t}();function _(e){c((e=e||window.event).stopPropagation)?e.stopPropagation():e.cancelBubble=!0,!1===e.cancelBubble&&(e.cancelBubble=!0)}var a,h,v=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")};function u(e,t){return e&&t&&(t=v(t),e.classList?e.classList.contains(t):-1<(" "+e.className+" ").indexOf(" "+t+" "))}function m(e,t){if(e&&t)for(var i=Array.isArray(t)?t:v(t).split(/\s/),s=i.length,r=0;r<s;r++){var n=i[r];n&&!u(e,n)&&(e.classList?e.classList.add(n):e.className+=" "+n)}}function b(e,t){if(e&&t)for(var i=Array.isArray(t)?t:v(t).split(/\s/),s=i.length,r=0;r<s;r++){var n=i[r];n&&u(e,n)&&(e.classList?e.classList.remove(n):(e.className=(" "+e.className+" ").replace(" "+n+" "," "),e.className=v(e.className)))}}function p(e){return(a=a||(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return setTimeout(e,16)}).bind(window))(e)}function f(e){(h=h||(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)}).bind(window))(e)}function w(e,t,i){var s=e.ownerDocument.defaultView;return((s=s||window).getComputedStyle(e,i||null)||{display:"none"})[t]}function $(e){if(!document.documentElement.contains(e))return{detached:!0,rendered:!1};for(var t=e;t!==document;){if("none"===w(t,"display"))return{detached:!1,rendered:!1};t=t.parentNode}return{detached:!1,rendered:!0}}var g=0,z=null;function y(e,t){if(e){var i,s;if(e.__resize_mutation_handler__||(e.__resize_mutation_handler__=function(){var e=$(this),t=e.rendered,i=e.detached;t!==this.__resize_rendered__&&(!i&&this.__resize_triggers__&&(k(this),this.addEventListener("scroll",H,!0)),this.__resize_rendered__=t,T(this))}.bind(e)),!e.__resize_listeners__)if(e.__resize_listeners__=[],window.ResizeObserver){var r=e.offsetWidth,n=e.offsetHeight,l=new ResizeObserver(function(){!e.__resize_observer_triggered__&&(e.__resize_observer_triggered__=!0,e.offsetWidth===r&&e.offsetHeight===n)||T(e)}),o=$(e),a=o.detached,h=o.rendered;e.__resize_observer_triggered__=!1===a&&!1===h,(e.__resize_observer__=l).observe(e)}else if(e.attachEvent&&e.addEventListener)e.__resize_legacy_resize_handler__=function(){T(e)},e.attachEvent("onresize",e.__resize_legacy_resize_handler__),document.addEventListener("DOMSubtreeModified",e.__resize_mutation_handler__);else if(g||(i='.resize-triggers{visibility:hidden;opacity:0}.resize-contract-trigger,.resize-contract-trigger:before,.resize-expand-trigger,.resize-triggers{content:"";position:absolute;top:0;left:0;height:100%;width:100%;overflow:hidden}.resize-contract-trigger,.resize-expand-trigger{background:#eee;overflow:auto}.resize-contract-trigger:before{width:200%;height:200%}',(s=document.createElement("style")).type="text/css",s.styleSheet?s.styleSheet.cssText=i:s.appendChild(document.createTextNode(i)),(document.querySelector("head")||document.body).appendChild(s),z=s),function(e){var t=w(e,"position");t&&"static"!==t||(e.style.position="relative");e.__resize_old_position__=t,e.__resize_last__={};var i=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div");i.className="resize-triggers",s.className="resize-expand-trigger",n.className="resize-contract-trigger",s.appendChild(r),i.appendChild(s),i.appendChild(n),e.appendChild(i),e.__resize_triggers__={triggers:i,expand:s,expandChild:r,contract:n},k(e),e.addEventListener("scroll",H,!0),e.__resize_last__={width:e.offsetWidth,height:e.offsetHeight}}(e),e.__resize_rendered__=$(e).rendered,window.MutationObserver){var c=new MutationObserver(e.__resize_mutation_handler__);c.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),e.__resize_mutation_observer__=c}e.__resize_listeners__.push(t),g++}}function H(){var o=this;k(this),this.__resize_raf__&&f(this.__resize_raf__),this.__resize_raf__=p(function(){var e,t,i,s,r,n,l=(t=(e=o).__resize_last__,i=t.width,s=t.height,r=e.offsetWidth,n=e.offsetHeight,r!==i||n!==s?{width:r,height:n}:null);l&&(o.__resize_last__=l,T(o))})}function T(t){t&&t.__resize_listeners__&&t.__resize_listeners__.forEach(function(e){e.call(t,t)})}function k(e){var t=e.__resize_triggers__,i=t.expand,s=t.expandChild,r=t.contract,n=r.scrollWidth,l=r.scrollHeight,o=i.offsetWidth,a=i.offsetHeight,h=i.scrollWidth,c=i.scrollHeight;r.scrollLeft=n,r.scrollTop=l,s.style.width=o+1+"px",s.style.height=a+1+"px",i.scrollLeft=h,i.scrollTop=c}function Y(e){var t;(t=e)&&1===t.nodeType&&"string"==typeof t.nodeName&&(e={element:e}),this.element=null,this.horizontal=!1,this.minThumbSize=20,this.forceRenderTrack=!0,this.useRender=!0,this.useResize=!0,this.useShadow=!1,this.beforeCreate=null,this.created=null,this.beforeDestroy=null,this.destroyed=null,this.onResize=null,this.onScroll=null,this.onUpdate=null,function(e){for(var t=arguments,i=1;i<arguments.length;i++)for(var s in arguments[i])Object.prototype.hasOwnProperty.call(t[i],s)&&(t[0][s]=t[i][s])}(this,e),this._events={},this._scrollbarWidth=function(){if(void 0!==i)return i;var e=document.createElement("div");return e.style.position="absolute",e.style.top="-9999px",e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",document.body.appendChild(e),i=e.offsetWidth-e.clientWidth,document.body.removeChild(e),i}(),this._preventRenderTrack=l||!1===this.forceRenderTrack&&0===this._scrollbarWidth,this._created=!1,this._cursorDown=!1,this._prevPageX=0,this._prevPageY=0,this._scrollTopMax=0,this._scrollLeftMax=0,this._trackTopMax=0,this._trackLeftMax=0,this.$view=this.element,this.$scrollbarY=null,this.$scrollbarX=null,this.$sliderY=null,this.$sliderX=null,this.$shadowY=null,this.$shadowX=null,this.$resizeObserver=null,"useResize"in e?this.useResize=e.useResize:this._preventRenderTrack&&(this.useResize=c(this.onResize))}var X="Scrollbar",x={element:"scrollable-wrapper",view:"view",horizontalScrollbar:"scrollbar is-horizontal",verticalScrollbar:"scrollbar is-vertical",thumb:"thumb",horizontalShadow:"shadow is-horizontal",verticalShadow:"shadow is-vertical",resizeObserver:"resize-observer",horizontal:"is-horizontal",unselect:"is-unselect",prevented:"is-default",visible:"is-visible",invisible:"is-invisible",active:"is-active",force:"is-force-render",hiddenDefault:"is-hidden-default",observed:"is-observed"},E="onwheel"in document.body?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";return Y.prototype.create=function(){if(this._created)return console.warn("calling on a already-created object"),this;if(c(this.beforeCreate)&&this.beforeCreate(),this.useRender){for(this.$view=document.createElement("div"),this.$resizeObserver=document.createElement("div"),this.$view.className=x.view,this.$resizeObserver.className=x.resizeObserver;0<this.element.childNodes.length;)this.$resizeObserver.appendChild(this.element.childNodes[0]);this.$view.appendChild(this.$resizeObserver),this.element.appendChild(this.$view),!1===this._preventRenderTrack&&(this.$scrollbarX=document.createElement("div"),this.$scrollbarY=document.createElement("div"),this.$sliderX=document.createElement("div"),this.$sliderY=document.createElement("div"),this.$scrollbarX.className=x.horizontalScrollbar,this.$scrollbarY.className=x.verticalScrollbar,this.$sliderX.className=x.thumb,this.$sliderY.className=x.thumb,this.$scrollbarX.appendChild(this.$sliderX),this.$scrollbarY.appendChild(this.$sliderY),this.element.appendChild(this.$scrollbarX),this.element.appendChild(this.$scrollbarY))}else this.$view=this.element.querySelector("."+x.view),this.$resizeObserver=this.$view.querySelector("."+x.resizeObserver),this.$scrollbarX=this.element.querySelector("."+x.horizontalScrollbar.split(/\s/).join(".")),this.$scrollbarY=this.element.querySelector("."+x.verticalScrollbar.split(/\s/).join(".")),this.$scrollbarX&&(this.$sliderX=this.$scrollbarX.querySelector("."+x.thumb)),this.$scrollbarY&&(this.$sliderY=this.$scrollbarY.querySelector("."+x.thumb));return m(this.element,x.element),this.forceRenderTrack&&m(this.element,x.force),this._scrollbarWidth<=0&&m(this.element,x.hiddenDefault),this._preventRenderTrack&&m(this.element,x.prevented),!0===this.horizontal&&(m(this.element,x.horizontal),m(this.$scrollbarY,x.invisible)),this.useShadow&&this._createShadow(),this.useResize&&this._createResizeTrigger(),this._created=!0,c(this.created)&&this.created(),this._bindEvents().update()},Y.prototype.update=function(){if(this._preventRenderTrack)return this;if(!1===this._created)return console.warn("calling on a not-yet-created object"),this;0<this._scrollbarWidth?(this.$view.style.width="calc(100% + "+this._scrollbarWidth+"px)",this.$view.style.height="calc(100% + "+this._scrollbarWidth+"px)"):(this.$view.style.width="",this.$view.style.height="");var e=w(this.element,"padding");e.split(" ").every(function(e){return 0===parseInt(e)})||(this.$resizeObserver.style.padding=e,this.element.style.cssText+=";padding: 0px !important;"),b(this.$scrollbarY,x.invisible),b(this.$scrollbarX,x.invisible);var t=this.$view.clientWidth/this.$view.scrollWidth*this.$scrollbarX.offsetWidth,i=this.$view.clientHeight/this.$view.scrollHeight*this.$scrollbarY.offsetHeight;this._scrollTopMax=this.$view.scrollHeight-this.$view.clientHeight,this._scrollLeftMax=this.$view.scrollWidth-this.$view.clientWidth;var s=0,r=0;return this._scrollLeftMax<=0?m(this.$scrollbarX,x.invisible):s=Math.max(t,this.minThumbSize),this.$sliderX.style.width=s+"px",this._scrollTopMax<=0?m(this.$scrollbarY,x.invisible):r=Math.max(i,this.minThumbSize),this.$sliderY.style.height=r+"px",this._trackTopMax=this.$scrollbarY.clientHeight-this.$sliderY.offsetHeight,this._trackLeftMax=this.$scrollbarX.clientWidth-this.$sliderX.offsetWidth,c(this.onUpdate)&&this.onUpdate(),this._scrollHandler(),this},Y.prototype.destroy=function(){if(!1===this._created)return console.warn("calling on a not-yet-created object"),this;if(b(this.element,[x.horizontal,x.observed,x.prevented,x.hiddenDefault,x.force,x.element]),this._unbindEvents(),this.useResize&&function(e,t){var i=e&&e.__resize_listeners__;if(i){if(t&&i.splice(i.indexOf(t),1),!i.length||!t){if(e.detachEvent&&e.removeEventListener)return e.detachEvent("onresize",e.__resize_legacy_resize_handler__),document.removeEventListener("DOMSubtreeModified",e.__resize_mutation_handler__);e.__resize_observer__?(e.__resize_observer__.unobserve(e),e.__resize_observer__.disconnect(),e.__resize_observer__=null):(e.__resize_mutation_observer__&&(e.__resize_mutation_observer__.disconnect(),e.__resize_mutation_observer__=null),e.removeEventListener("scroll",H),e.removeChild(e.__resize_triggers__.triggers),e.__resize_triggers__=null),e.__resize_listeners__=null}!--g&&z&&z.parentNode.removeChild(z)}}(this.$resizeObserver,this._events.resizeHandler),this.useShadow&&(this.element.removeChild(this.$shadowY),this.element.removeChild(this.$shadowX),this.$shadowY=null,this.$shadowX=null),!0===this.useRender){for(this._preventRenderTrack||(this.element.removeChild(this.$scrollbarY),this.element.removeChild(this.$scrollbarX),this.$scrollbarY=null,this.$scrollbarX=null,this.$sliderY=null,this.$sliderX=null);0<this.$resizeObserver.childNodes.length;)this.element.appendChild(this.$resizeObserver.childNodes[0]);this.element.removeChild(this.$view),this.$resizeObserver=null,this.$view=null}else this.$view.style.width="",this.$view.style.height="",!1===this._preventRenderTrack?(b(this.$scrollbarY,x.invisible),b(this.$scrollbarX,x.invisible)):(m(this.$scrollbarY,x.invisible),m(this.$scrollbarX,x.invisible));return this._created=!1,null},Y.prototype.getViewElement=function(){return this.$view},Y.prototype._createResizeTrigger=function(){m(this.element,x.observed),this._events.resizeHandler=this._resizeHandler.bind(this),y(this.$resizeObserver,this._events.resizeHandler)},Y.prototype._createShadow=function(){this.$shadowX=document.createElement("div"),this.$shadowY=document.createElement("div"),this.element.appendChild(this.$shadowX),this.element.appendChild(this.$shadowY),this.$shadowX.className=x.horizontalShadow+" "+x.invisible,this.$shadowY.className=x.verticalShadow+" "+x.invisible},Y.prototype._resizeHandler=function(){this.update(),c(this.onResize)&&this.onResize()},Y.prototype._bindEvents=function(){return this._events.scrollHandler=this._scrollHandler.bind(this),this._events.clickHorizontalTrackHandler=this._clickTrackHandler(!1).bind(this),this._events.clickVerticalTrackHandler=this._clickTrackHandler(!0).bind(this),this._events.clickHorizontalThumbHandler=this._clickThumbHandler(!1).bind(this),this._events.clickVerticalThumbHandler=this._clickThumbHandler(!0).bind(this),this._events.mouseScrollTrackHandler=this._mouseScrollTrackHandler.bind(this),this._events.mouseUpDocumentHandler=this._mouseUpDocumentHandler.bind(this),this._events.mouseMoveDocumentHandler=this._mouseMoveDocumentHandler.bind(this),!l&&this.horizontal?this.$view.addEventListener(E,this._events.mouseScrollTrackHandler,!!o&&{capture:!1,passive:!1}):this.$view.addEventListener("scroll",this._events.scrollHandler),!1===this._preventRenderTrack&&(this.$scrollbarX.addEventListener("mousedown",this._events.clickHorizontalTrackHandler),this.$scrollbarY.addEventListener("mousedown",this._events.clickVerticalTrackHandler),this.$sliderX.addEventListener("mousedown",this._events.clickHorizontalThumbHandler),this.$sliderY.addEventListener("mousedown",this._events.clickVerticalThumbHandler),this.$scrollbarX.addEventListener(E,this._events.mouseScrollTrackHandler),this.$scrollbarY.addEventListener(E,this._events.mouseScrollTrackHandler),document.addEventListener("mouseup",this._events.mouseUpDocumentHandler)),this},Y.prototype._unbindEvents=function(){return this.$view.removeEventListener("scroll",this._events.scrollHandler),this.$view.removeEventListener(E,this._events.mouseScrollTrackHandler),!1===this._preventRenderTrack&&(this.$scrollbarY.removeEventListener("mousedown",this._events.clickVerticalTrackHandler),this.$scrollbarX.removeEventListener("mousedown",this._events.clickHorizontalTrackHandler),this.$sliderY.removeEventListener("mousedown",this._events.clickVerticalThumbHandler),this.$sliderX.removeEventListener("mousedown",this._events.clickHorizontalThumbHandler),this.$scrollbarY.removeEventListener(E,this._events.mouseScrollTrackHandler),this.$scrollbarX.removeEventListener(E,this._events.mouseScrollTrackHandler),document.removeEventListener("mouseup",this._events.mouseUpDocumentHandler),document.removeEventListener("mousemove",this._events.mouseMoveDocumentHandler)),this},Y.prototype._scrollHandler=function(){var e=this.$view.scrollLeft*this._trackLeftMax/this._scrollLeftMax||0,t=this.$view.scrollTop*this._trackTopMax/this._scrollTopMax||0;this.useShadow&&this._setShadowStyle(),!1===this._preventRenderTrack&&(this.$sliderX.style.msTransform="translateX("+e+"px)",this.$sliderX.style.webkitTransform="translate3d("+e+"px, 0, 0)",this.$sliderX.style.transform="translate3d("+e+"px, 0, 0)",this.$sliderY.style.msTransform="translateY("+t+"px)",this.$sliderY.style.webkitTransform="translate3d(0, "+t+"px, 0)",this.$sliderY.style.transform="translate3d(0, "+t+"px, 0)"),c(this.onScroll)&&this.onScroll(this.$view.scrollLeft,this.$view.scrollTop)},Y.prototype._setShadowStyle=function(){this.$view.scrollTop<=0?(b(this.$shadowY,x.visible),m(this.$shadowY,x.invisible)):(m(this.$shadowY,x.visible),b(this.$shadowY,x.invisible)),this.$view.scrollLeft>=this.$view.scrollWidth-this.$view.clientWidth?(b(this.$shadowX,x.visible),m(this.$shadowX,x.invisible)):(m(this.$shadowX,x.visible),b(this.$shadowX,x.invisible))},Y.prototype._mouseScrollTrackHandler=function(e){var t,i,s=this,r=0,n=0;_(e),c(e.preventDefault)?e.preventDefault():e.returnValue=!1,n=e.deltaY||e.wheelDeltaY||-e.wheelDelta||0,r=e.deltaX||e.wheelDeltaX||0,d&&(n*=40,r*=40),e.shiftKey&&(r=(t=[n,r])[0],n=t[1]),this.horizontal&&(r=(i=[n,r])[0],n=i[1]),e.altKey&&(r*=r,n*=n);var l,o=0,a=0;(0<Math.abs(n)||0<Math.abs(r))&&(o=Math.abs(r)/10,a=Math.abs(n)/10);var h=function(){o>=Math.abs(r)&&a>=Math.abs(n)?f(l):(0!==n&&Math.abs(a)<=Math.abs(n)&&(a+=0<n?10:-10,s.$view.scrollTop+=0<n?10:-10),0!==r&&Math.abs(o)<=Math.abs(r)&&(o+=0<r?10:-10,s.$view.scrollLeft+=0<r?10:-10),s.horizontal&&s._scrollHandler(),l=p(h))};l=p(h)},Y.prototype._clickTrackHandler=function(i){var s=this;return function(e){var t;i?(t=100*(Math.abs(e.target.getBoundingClientRect().top-e.clientY)-s.$sliderY.offsetHeight/2)/s.$scrollbarY.offsetHeight,s.$view.scrollTop=t*s.$view.scrollHeight/100):(t=100*(Math.abs(e.target.getBoundingClientRect().left-e.clientX)-s.$sliderX.offsetWidth/2)/s.$scrollbarX.offsetWidth,s.$view.scrollLeft=t*s.$view.scrollWidth/100),!0===s.horizontal&&s._scrollHandler()}},Y.prototype._clickThumbHandler=function(t){var i=this;return function(e){_(e),e.ctrlKey||2===e.button||(m(e.currentTarget,x.active),i._startDrag(e),t?i._prevPageY=e.currentTarget.offsetHeight-(e.clientY-e.currentTarget.getBoundingClientRect().top):i._prevPageX=e.currentTarget.offsetWidth-(e.clientX-e.currentTarget.getBoundingClientRect().left))}},Y.prototype._startDrag=function(e){e.stopImmediatePropagation(),this._cursorDown=!0,m(document.body,x.unselect),document.addEventListener("mousemove",this._events.mouseMoveDocumentHandler),document.onselectstart=function(){return!1}},Y.prototype._mouseUpDocumentHandler=function(){this._cursorDown=!1,this._prevPageX=this._prevPageY=0,b(document.body,x.unselect),b(this.$sliderY,x.active),b(this.$sliderX,x.active),document.removeEventListener("mousemove",this._events.mouseMoveDocumentHandler),document.onselectstart=null},Y.prototype._mouseMoveDocumentHandler=function(e){var t,i;if(!1!==this._cursorDown)return this._prevPageY?(t=e.clientY-this.$scrollbarY.getBoundingClientRect().top,i=this.$sliderY.offsetHeight-this._prevPageY,this.$view.scrollTop=this._scrollTopMax*(t-i)/this._trackTopMax,void(!0===this.horizontal&&this._scrollHandler())):void(this._prevPageX&&(t=e.clientX-this.$scrollbarX.getBoundingClientRect().left,i=this.$sliderX.offsetWidth-this._prevPageX,this.$view.scrollLeft=this._scrollLeftMax*(t-i)/this._trackLeftMax,!0===this.horizontal&&this._scrollHandler()))},window[X]||(window[X]=Y),Y});
